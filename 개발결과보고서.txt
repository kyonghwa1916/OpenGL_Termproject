================================================================================
                    컴퓨터 그래픽스 최종 프로젝트 개발 결과 보고서
                          Night Street Driving Simulator
================================================================================

1. 프로젝트 소개
================================================================================

프로젝트명: Night Street Driving Simulator (야간 도로 주행 시뮬레이터)

본 프로젝트는 OpenGL을 활용하여 야간 도로에서 자동차를 운전하는 3D 시뮬레이터를
구현한 것입니다. 실시간 조명 시스템, 텍스처 매핑, 3D 모델링 기술을 결합하여
몰입감 있는 주행 경험을 제공합니다.

주요 특징:
- 동적 조명 시스템 (Point Light 기반 가로등 조명)
- 실시간 3D 자동차 제어 (전진/후진/회전)
- 물리 기반 렌더링 (Phong Shading)
- 텍스처 매핑된 도로 환경
- 키 동시 입력 지원
- 곡선 도로 시스템 (2가지 맵)
- 충돌 감지 시스템
- 타이머 및 랭킹 시스템


2. 프로젝트 구조 설명
================================================================================

2.1 데이터 구조
--------------------------------------------------------------------------------

[게임 상태]
- GameState currentState: 게임 상태 관리 (MENU, PLAY, GAMEOVER, RANKING, NAME_INPUT)
- int selectedMap: 선택된 맵 (1 또는 2)

[전역 상태 변수]
- float carX, carZ, carAngle: 자동차의 위치 및 회전 상태
- bool specialKeyStates[256]: 키보드 입력 상태 추적 배열

[타이머 관련]
- bool timerStarted: 타이머 시작 여부
- int startTime, elapsedTime: 시작 시간 및 경과 시간
- bool finishReached: 피니시라인 도달 여부

[랭킹 시스템]
- std::vector<RankingEntry> rankingsMap1, rankingsMap2: 맵별 랭킹 데이터
- std::string currentInputName: 현재 입력 중인 이름
- float recordedTime: 완주 시간 기록

[렌더링 객체]
- GLuint bgVAO, bgVBO: 배경(도로/인도) 버텍스 데이터
- GLuint carVAO, carVBO: 자동차 모델 버텍스 데이터
- GLuint lightVAO, lightVBO: 가로등 모델 버텍스 데이터
- GLuint finishLineVAO, finishLineVBO: 피니시라인 버텍스 데이터

[쉐이더 유니폼]
- modelLoc, viewLoc, projLoc: MVP 행렬
- useTextureLoc: 텍스처 사용 여부
- isLightSourceLoc: 발광체 여부
- viewPosLoc: 카메라 위치 (반사광 계산용)

[텍스처 리소스]
- roadTextureID: 도로 텍스처
- dirtTextureID: 인도 텍스처


2.2 정점 데이터 구조
--------------------------------------------------------------------------------

각 정점은 11개의 float 값으로 구성:
- Position (3): X, Y, Z 좌표
- Color (3): R, G, B 색상
- TexCoord (2): U, V 텍스처 좌표
- Normal (3): 법선 벡터 (조명 계산용)


2.3 주요 함수 구조
--------------------------------------------------------------------------------

[초기화 함수]
- make_Shaders(): 버텍스/프래그먼트 쉐이더 컴파일 및 링크
- initMapBuffer(): 맵별 곡선 도로 및 인도 지오메트리 생성
- initFinishLine(): 노란색 피니시라인 생성
- initCubeObj(): 3D 객체(자동차/가로등) 생성
- LoadTexture(): 이미지 파일에서 텍스처 로드
- initGame(): 게임 초기화 (맵 선택 및 차량 초기 위치 설정)

[도로 생성 함수]
- getRoadCenterX(): Z 위치에 따른 도로 중심 X 좌표 계산 (곡선 구현)
- getRoadAngle(): 도로의 접선 각도 계산 (가로등 회전에 사용)

[렌더링 함수]
- drawScene(): 메인 렌더링 루프
  - 게임 상태별 화면 렌더링 (메뉴, 플레이, 게임오버, 랭킹, 이름입력)
  - 카메라 설정 (자동차 뒤에서 추적하는 3인칭 시점)
  - 동적 조명 계산 (자동차 주변 4개 가로등만 활성화)
  - 도로, 인도, 피니시라인, 가로등, 자동차 순차 렌더링
- drawString(): 화면에 텍스트 출력 (UI 및 정보 표시)

[입력 처리 함수]
- updateCar(): 키 상태에 따라 자동차 위치/각도 업데이트 및 충돌 감지
- SpecialKeyboard/Up(): 화살표 키 입력 처리
- Keyboard(): 게임 상태별 키보드 입력 처리 (맵 선택, 이름 입력 등)
- Timer(): 16ms 주기 업데이트 (60 FPS)

[랭킹 시스템 함수]
- loadRankings(): rankings.txt 파일에서 기록 불러오기
- saveRanking(): 새 기록을 파일에 저장 (상위 5개만 유지)

[수학 헬퍼 함수]
- setIdentityMatrix(): 단위 행렬 생성
- makePerspectiveMatrix(): 원근 투영 행렬 생성
- setTranslationMatrix(): 이동 행렬 생성
- setRotationYMatrix(): Y축 회전 행렬 생성
- multiplyMatrix(): 4x4 행렬 곱셈


2.4 좌표계 시스템
--------------------------------------------------------------------------------

[월드 좌표계]
- X축: 좌(-) / 우(+)
- Y축: 아래(-) / 위(+)
- Z축: 앞(-) / 뒤(+)

[자동차 로컬 좌표계]
- 자동차 정면: -Z 방향
- 회전: Y축 기준 회전 (carAngle)
- 이동: 로컬 좌표계 기준 전방 벡터 계산


3. 프로젝트 진행 사항
================================================================================

[1단계] 프로젝트 초기 설정 (커밋: a550d0a)
- OpenGL 프로젝트 환경 구축
- 기본 쉐이더 파일 작성
- GLEW, freeGLUT 라이브러리 설정

[2단계] 기본 환경 구현 (커밋: d32cd90)
- 도로 및 인도 지오메트리 생성
- 텍스처 매핑 시스템 구현
- 가로등 모델링 (기둥, 팔, 전구)

[3단계] 조명 시스템 구현 (커밋: ac2c85f)
- Phong Shading 모델 적용
- Point Light 기반 가로등 조명
- 동적 조명 시스템 (자동차 위치 기반 4개 활성화)
- 발광체 렌더링 (isLightSource 플래그)

[4단계] 자동차 제어 시스템 (커밋: 3bc6e40)
- 자동차 3D 모델링 (차체, 캐빈, 후드, 바퀴, 유리창, 헤드라이트)
- Y축 기준 회전 기능
- 로컬 좌표계 기반 이동
- 제자리 회전 구현

[5단계] 바퀴 개선 및 입력 시스템 (커밋: 8efa821)
- 박스 바퀴 → 원통(실린더) 바퀴로 변경
- 16개 세그먼트로 매끄러운 원형 구현
- 키 동시 입력 지원 (타이머 기반)
- 일정한 프레임레이트 유지 (60 FPS)

[6단계] 카메라 시스템 개선 (커밋: db99854)
- 카메라 거리 조정 (자동차 전체 보기)
- 3인칭 시점 최적화

[7단계] 곡선 도로 시스템 구현 (커밋: c31a410)
- Sin/Cos 함수 기반 곡선 도로 생성
- 2가지 맵 구현 (완만한 곡선 / 복잡한 곡선)
- 맵 선택 메뉴 추가
- 충돌 감지 시스템 (도로 이탈 시 게임오버)
- 도로 중심 기준 차량 충돌 반경 계산

[8단계] 피니시라인 및 타이머 시스템 (커밋: 7e1af0f)
- 노란색 피니시라인 추가 (Z = -495.0)
- 방향키 입력 시작부터 피니시라인 도달까지 시간 측정
- 실시간 타이머 화면 표시
- 완주 시 최종 시간 표시

[9단계] 랭킹 시스템 구현 (최종)
- 이름 입력 기능 (최대 10자)
- 맵별 상위 5개 기록 저장
- rankings.txt 파일 기반 영구 저장
- 랭킹 조회 화면 (R 키)
- 순위, 이름, 시간 표시


4. 팀원간 작업 내용
================================================================================

본 프로젝트는 2인 공동 작업으로 진행되었습니다.

[팀원 A - 렌더링 및 모델링]
- 쉐이더 프로그래밍 (버텍스/프래그먼트 쉐이더)
- 3D 모델링 (자동차, 가로등)
- 텍스처 시스템 구현
- 조명 시스템 설계 및 구현

[팀원 B - 물리 및 제어]
- 자동차 물리 시스템 (이동, 회전)
- 입력 처리 시스템
- 카메라 제어
- 타이머 기반 업데이트 루프

[공동 작업]
- 프로젝트 구조 설계
- Git을 통한 버전 관리
- 디버깅 및 최적화
- 통합 테스트


5. 개발 결과 소개
================================================================================

5.1 주요 기능
--------------------------------------------------------------------------------

[1] 실시간 3D 자동차 주행
- 전진/후진 시 자동차가 바라보는 방향으로 이동
- 부드러운 회전 (제자리 회전)
- 키 동시 입력 지원 (전진하면서 회전 가능)
- 자동차 뒤에서 추적하는 3인칭 카메라

[2] 곡선 도로 레이싱 시스템
- 2가지 난이도의 곡선 도로 맵
  * Map 1: 완만한 Sin 곡선 (초보자용)
  * Map 2: 복잡한 Sin+Cos 곡선 (고급자용)
- 도로 길이: 500 단위 (Z축 방향)
- 도로 폭: 2.0 단위, 인도 폭: 1.5 단위
- 곡선 도로를 따라 배치된 가로등

[3] 충돌 감지 시스템
- 실시간 도로 중심 좌표 계산
- 차량 충돌 반경: 0.5 단위
- 도로 이탈 시 게임오버
- 인도와의 충돌 감지

[4] 타이머 및 랭킹 시스템
- 방향키 첫 입력부터 피니시라인까지 시간 측정
- 실시간 타이머 화면 표시 (밀리초 단위)
- 완주 시 이름 입력 (최대 10자, BACKSPACE 지원)
- 맵별 상위 5개 기록 저장 (rankings.txt)
- 랭킹 조회 화면 (순위, 이름, 시간)

[5] 동적 조명 시스템
- 총 26개의 가로등 배치 (도로 양쪽)
- 자동차 주변 4개 가로등만 실시간 활성화 (성능 최적화)
- Point Light 기반 감쇠 효과
- 따뜻한 노란빛 조명 (1.0, 0.9, 0.6 RGB)

[6] 상세한 3D 모델
- 자동차: 차체, 캐빈, 후드, 원형 바퀴 4개, 유리창, 헤드라이트
- 가로등: 기둥, 팔, 전구 (발광 효과)
- 텍스처 매핑된 도로 및 인도
- 노란색 피니시라인

[7] 물리 기반 렌더링
- Phong Shading (Ambient + Diffuse + Specular)
- 법선 벡터 기반 정확한 조명 계산
- 거리 기반 감쇠 (Attenuation)

[8] 게임 UI 시스템
- 메인 메뉴 (맵 선택, 랭킹 조회)
- 게임 플레이 화면 (실시간 타이머)
- 이름 입력 화면 (커서 표시)
- 랭킹 화면 (맵별 상위 5개)
- 게임오버 화면


5.2 기술적 성과
--------------------------------------------------------------------------------

- VAO/VBO를 활용한 효율적인 지오메트리 관리
- 쉐이더 프로그래밍을 통한 GPU 가속 렌더링
- 동적 메모리 관리 (std::vector)
- 람다 함수를 활용한 모듈화된 코드
- 타이머 기반 일정한 프레임레이트 (60 FPS)
- 수학 함수 기반 절차적 지오메트리 생성 (Sin/Cos 곡선)
- 파일 I/O를 통한 데이터 영구 저장 (랭킹 시스템)
- 게임 상태 머신 패턴 적용 (5가지 상태 관리)
- 실시간 충돌 감지 알고리즘


5.3 렌더링 통계
--------------------------------------------------------------------------------

- 도로 정점: 약 260개 세그먼트 × 6 정점 = 1,560개
- 인도 정점: 약 260개 세그먼트 × 12 정점 = 3,120개
- 연석(턱) 정점: 약 260개 세그먼트 × 12 정점 = 3,120개
- 피니시라인 정점: 6개
- 가로등 정점: 108개 × 26개 = 2,808개
- 자동차 정점: 984개 (원통 바퀴 포함)
- 총 정점 수: 약 11,598개
- 활성 조명: 4개 (실시간 전환)
- 도로 길이: 500 단위 (시작 Z=20 ~ 끝 Z=-500)


6. 명령어 소개
================================================================================

6.1 키보드 명령어
--------------------------------------------------------------------------------

[메인 메뉴]
1           : Map 1 시작 (완만한 곡선)
2           : Map 2 시작 (복잡한 곡선)
R           : 랭킹 조회
Q           : 프로그램 종료

[게임 플레이 - 자동차 제어]
↑ (UP)      : 전진 (자동차가 바라보는 방향으로)
↓ (DOWN)    : 후진 (자동차가 바라보는 반대 방향으로)
← (LEFT)    : 좌회전 (제자리에서 Y축 기준 회전)
→ (RIGHT)   : 우회전 (제자리에서 Y축 기준 회전)

[이름 입력 화면]
문자 입력    : 이름 입력 (최대 10자)
BACKSPACE   : 문자 삭제
ENTER       : 저장 후 메뉴로 복귀

[랭킹 화면]
ESC         : 메인 메뉴로 복귀

[게임오버 화면]
R           : 메인 메뉴로 복귀

[조작 팁]
- 여러 키를 동시에 누를 수 있습니다
  예: UP + LEFT = 전진하면서 좌회전
      UP + RIGHT = 전진하면서 우회전
- 키를 누르고 있으면 연속 입력됩니다
- 첫 방향키 입력 시 타이머가 자동 시작됩니다
- 도로를 벗어나면 게임오버됩니다


6.2 파라미터 설정
--------------------------------------------------------------------------------

[이동 속도]
- speed = 0.3 (단위/프레임)
- 약 18 단위/초

[회전 속도]
- rotSpeed = 0.02 (라디안/프레임)
- 약 1.2 라디안/초 (약 69도/초)

[카메라]
- 거리: 10.0 단위
- 높이: 5.0 단위
- 시야각: 45도 (π/4)
- 추적 방식: 자동차 뒤에서 따라가는 3인칭 시점

[도로 설정]
- 도로 폭: 2.0 단위
- 인도 폭: 1.5 단위
- 차량 충돌 반경: 0.5 단위
- 도로 길이: 520 단위 (Z: 20 ~ -500)
- 피니시라인 위치: Z = -495.0

[맵별 곡선 공식]
- Map 1: X = sin(Z × 0.05) × 10.0
- Map 2: X = sin(Z × 0.1) × 10.0 + cos(Z × 0.05) × 5.0


7. 프로젝트 개발 소감 및 후기
================================================================================

7.1 기술적 배움
--------------------------------------------------------------------------------

본 프로젝트를 통해 OpenGL의 전반적인 파이프라인을 깊이 이해할 수 있었습니다.
특히 다음 부분에서 많은 성장이 있었습니다:

- 쉐이더 프로그래밍: GPU에서 실행되는 코드를 작성하면서 병렬 처리의
  중요성을 배웠습니다.

- 좌표계 변환: 로컬 좌표계, 월드 좌표계, 뷰 좌표계, 클립 좌표계의
  변환 과정을 직접 구현하며 3D 그래픽스의 수학적 기초를 다졌습니다.

- 조명 모델: Phong Shading을 직접 구현하면서 빛의 물리적 특성을
  시뮬레이션하는 방법을 배웠습니다.

- 성능 최적화: 30개의 조명 중 4개만 활성화하는 등 실시간 렌더링을 위한
  최적화 기법을 적용했습니다.


7.2 협업 경험
--------------------------------------------------------------------------------

Git을 활용한 버전 관리와 코드 리뷰를 통해 팀 프로젝트 경험을 쌓았습니다.
각자의 역할을 분담하되 자주 소통하며 통합하는 과정에서 협업의 중요성을
깨달았습니다.


7.3 어려웠던 점과 해결 과정
--------------------------------------------------------------------------------

[문제 1] 자동차 회전 시 위치 이탈
- 원인: 월드 좌표계 기준 회전
- 해결: 회전 행렬에 이동 성분을 직접 포함시켜 로컬 좌표계 회전 구현

[문제 2] 조명이 너무 어두움
- 원인: 법선 벡터가 잘못 계산됨
- 해결: 각 면마다 정확한 법선 벡터 할당

[문제 3] 키 동시 입력 불가
- 원인: 이벤트 기반 입력 처리
- 해결: 키 상태 배열 + 타이머 기반 업데이트로 전환

[문제 4] git add . 실패
- 원인: Windows 특수 파일 'nul'
- 해결: .gitignore에 nul 추가

[문제 5] 곡선 도로에서 차량이 튕겨나감
- 원인: 직선 도로 기준 고정 좌표로 충돌 감지
- 해결: getRoadCenterX() 함수로 실시간 도로 중심 계산

[문제 6] 가로등이 곡선을 따라가지 않음
- 원인: 가로등 위치가 직선 기준으로 배치됨
- 해결: 도로 중심 좌표와 접선 각도를 기반으로 가로등 배치


7.4 구현 완료된 주요 개선사항
--------------------------------------------------------------------------------

본 프로젝트는 기본 주행 시뮬레이터에서 시작하여 다음 기능들을 성공적으로 추가했습니다:

1. ✓ 곡선 도로 시스템 (2가지 맵)
2. ✓ 충돌 감지 시스템 (도로 이탈 감지)
3. ✓ 타이머 시스템 (방향키 입력부터 측정)
4. ✓ 랭킹 시스템 (이름 입력 및 파일 저장)
5. ✓ 게임 상태 관리 (메뉴, 플레이, 랭킹 등)
6. ✓ 피니시라인 및 완주 감지
7. ✓ 맵별 난이도 구분

7.5 향후 개선 방향
--------------------------------------------------------------------------------

추가로 구현하면 더욱 완성도를 높일 수 있는 기능들:

1. 마우스를 통한 카메라 제어 (1인칭/3인칭 전환)
2. 더 많은 맵 레이아웃 (도시, 산악, 고속도로)
3. 미니맵 UI (현재 위치 표시)
4. 날씨 효과 (비, 안개, 밤/낮 전환)
5. 더 많은 차량 모델 선택
6. AI 차량 (NPC 경쟁자)
7. 사운드 효과 (엔진 소리, 배경음악)
8. 체크포인트 시스템
9. 리플레이 기능
10. 멀티플레이어 모드


7.6 마무리
--------------------------------------------------------------------------------

이번 프로젝트를 통해 단순히 API를 사용하는 것을 넘어, 3D 그래픽스의
기본 원리와 실시간 렌더링 기술을 깊이 이해할 수 있었습니다.

특히 수업에서 배운 이론(MVP 변환, 조명 모델, 쉐이더 등)을 직접 구현하며
확실하게 체득할 수 있었던 점이 가장 큰 수확이었습니다.

초기 직선 도로 시뮬레이터에서 시작하여 곡선 도로, 충돌 감지, 타이머,
랭킹 시스템까지 단계적으로 기능을 추가하면서 게임 개발의 전체 과정을
경험할 수 있었습니다. 특히 수학 함수(Sin/Cos)를 활용한 절차적 지오메트리
생성과 실시간 충돌 감지 알고리즘 구현은 알고리즘적 사고력을 키우는 데
큰 도움이 되었습니다.

또한 파일 I/O를 통한 랭킹 시스템, 게임 상태 머신 패턴 등 실제 게임에서
사용되는 디자인 패턴과 시스템을 구현하면서 소프트웨어 설계 능력도
향상시킬 수 있었습니다.

OpenGL이라는 강력한 도구를 활용하여 실시간 3D 레이싱 게임을 만드는
경험은 앞으로 게임 개발이나 시각화 분야로 나아가는 데 큰 자산이
될 것이라 확신합니다.


================================================================================
                              프로젝트 개발팀

                    GitHub: kyonghwa1916/OpenGL_Termproject
================================================================================
